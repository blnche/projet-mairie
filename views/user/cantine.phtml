<?php
$weeks = $this->data['cafeteria-weeks'];
//var_dump($weeks);
$children = $this->data['children'];
$childrenEnrollments = $this->data['childrenEnrollments'];
//var_dump($childrenEnrollments);

?>
<section class="main-container">
    <h1> <?= $this->pageTitle; ?> </h1>
    <input type="text" name="search" id="searchInput" placeholder="Chercher semaine XX ...">
    <section class="table-container">
        <table>
            <thead>
            <tr>
                <th>Week</th>
                <th>Monday</th>
                <th>Tuesday</th>
                <th>Wednesday</th>
                <th>Thursday</th>
                <th>Friday</th>
                <th>Actions</th>
                <th>Enfants</th>
            </tr>
            </thead>
            <tbody id="searchListItems">
            <?php
            foreach ($weeks as $week)
            {
        
        
                ?>
                <tr>
                    <td> <?= $week->getWeekOfYear(); ?></td>
                    <!--have another td that takes all td with days inside of it inside a table and tr element-->
                      <td>
                        <ul>
                            <?php
                            foreach ($this->data['childrenEnrollments'] as $childEnrollments)
                            {
                                ?>
                                <li>
                                    <?php
                                    $firstName = $childEnrollments[0];
                                    //echo $firstName;
                                    $foundMatch = false;
                                    foreach ($childEnrollments[1] as $enrollment)
                                    {
                                        //echo $enrollment->getWeekOfYear();
                                        //echo $week->getWeekOfYear();
        
                                        if (!$foundMatch && $enrollment->getWeekOfYear() === $week->getWeekOfYear())
                                        {
                                            $foundMatch = true;
                                            //echo 'not empty';
                                            echo checkStatus($enrollment->getMonday(), '', 'monday');
                                            break;
                                        }
                                        else
                                        {
                                            //echo 'empty';
                                            echo checkStatus($week->getMonday(), '', 'monday');
                                        }
                                    }
                                    ?>
                                </li>
                                <?php
                            }
                            ?>
                        </ul>
                    </td>
                    <td>
                        <ul>
                            <?php
                            foreach ($this->data['childrenEnrollments'] as $childEnrollments)
                            {
                                ?>
                                <li>
                                    <?php
                                    $firstName = $childEnrollments[0];
                                    //echo $firstName;
                                    $foundMatch = false;
                                    foreach ($childEnrollments[1] as $enrollment)
                                    {
                                        //echo $enrollment->getWeekOfYear();
                                        //echo $week->getWeekOfYear();
        
                                        if (!$foundMatch && $enrollment->getWeekOfYear() === $week->getWeekOfYear())
                                        {
                                            $foundMatch = true;
                                            //echo 'not empty';
                                            echo checkStatus($enrollment->getTuesday(), '', 'tuesday');
                                            break;
                                        }
                                        else
                                        {
                                            //echo 'empty';
                                            echo checkStatus($week->getTuesday(), '', 'tuesday');
                                        }
                                    }
                                    ?>
                                </li>
                                <?php
                            }
                            ?>
                        </ul>
                    </td>
                    <td>
                        <ul>
                            <?php
                            foreach ($this->data['childrenEnrollments'] as $childEnrollments)
                            {
                                ?>
                                <li>
                                    <?php
                                    $firstName = $childEnrollments[0];
                                    //echo $firstName;
                                    $foundMatch = false;
                                    foreach ($childEnrollments[1] as $enrollment)
                                    {
                                        //echo $enrollment->getWeekOfYear();
                                        //echo $week->getWeekOfYear();
        
                                        if (!$foundMatch && $enrollment->getWeekOfYear() === $week->getWeekOfYear())
                                        {
                                            $foundMatch = true;
                                            //echo 'not empty';
                                            echo checkStatus($enrollment->getWednesday(), '', 'wednesday');
                                            break;
                                        }
                                        else
                                        {
                                            //echo 'empty';
                                            echo checkStatus($week->getWednesday(), '', 'wednesday');
                                        }
                                    }
                                    ?>
                                </li>
                                <?php
                            }
                            ?>
                        </ul>
                    </td>
                    <td>
                        <ul>
                            <?php
                            foreach ($this->data['childrenEnrollments'] as $childEnrollments)
                            {
                                ?>
                                <li>
                                    <?php
                                    $firstName = $childEnrollments[0];
                                    //echo $firstName;
                                    $foundMatch = false;
                                    foreach ($childEnrollments[1] as $enrollment)
                                    {
                                        //echo $enrollment->getWeekOfYear();
                                        //echo $week->getWeekOfYear();
        
                                        if (!$foundMatch && $enrollment->getWeekOfYear() === $week->getWeekOfYear())
                                        {
                                            $foundMatch = true;
                                            //echo 'not empty';
                                            echo checkStatus($enrollment->getThursday(), '', 'thursday');
                                            break;
                                        }
                                        else
                                        {
                                            //echo 'empty';
                                            echo checkStatus($week->getThursday(), '', 'thursday');
                                        }
                                    }
                                    ?>
                                </li>
                                <?php
                            }
                            ?>
                        </ul>
                    </td>
                    <td>
                        <ul>
                            <?php
                            foreach ($this->data['childrenEnrollments'] as $childEnrollments)
                            {
                                ?>
                                <li>
                                    <?php
                                    $firstName = $childEnrollments[0];
                                    //echo $firstName;
                                    $foundMatch = false;
                                    foreach ($childEnrollments[1] as $enrollment)
                                    {
                                        //echo $enrollment->getWeekOfYear();
                                        //echo $week->getWeekOfYear();
        
                                        if (!$foundMatch && $enrollment->getWeekOfYear() === $week->getWeekOfYear())
                                        {
                                            $foundMatch = true;
                                            //echo 'not empty';
                                            echo checkStatus($enrollment->getFriday(), '', 'friday');
                                            break;
                                        }
                                        else
                                        {
                                            //echo 'empty';
                                            echo checkStatus($week->getFriday(), '', 'friday');
                                        }
                                    }
                                    ?>
                                </li>
                                <?php
                            }
                            ?>
                        </ul>
                    </td>
                    <td><a href="/projet-final/projet-mairie/espace-famille/<?= $_SESSION['user_lastName'] ?>/cantine/inscrire/<?= $week->getWeekOfYear(); ?>">Inscrire</a></td>
                    <td>
                        <ul>
                            <?php
                            foreach ($this->data['childrenEnrollments'] as $childEnrollments)
                            {
                                ?>
                                <li>
                                <?php
                                $firstName = $childEnrollments[0];
                                echo $firstName;
                                    $foundMatch = false;
                                foreach ($childEnrollments[1] as $enrollment)
                                {
                                    //echo $enrollment->getWeekOfYear();
                                    //echo $week->getWeekOfYear();
                                    if (!$foundMatch && $week->getWeekOfYear() === $enrollment->getWeekOfyear())
                                    {
                                        $foundMatch = true;
                                        echo ' Inscrit';
                                        break;
                                    }
                                    else
                                    {
                                        echo ' Pas inscrit';
                                    }
                                }
                                ?>
                                </li>
                            <?php
                            }
                            ?>
                        </ul>
                    </td>
                </tr>
                </tr>
                <?php
            }
            ?>
            </tbody>
        </table>
        
    </section>
</section>