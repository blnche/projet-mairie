<?php
$weeks = $this->data['cafeteria-weeks'];
$children = $this->data['children'];
$childrenEnrollments = $this->data['childrenEnrollments'];
?>
<h1> <?= $this->pageTitle; ?> </h1>
<table>
    <thead>
    <tr>
        <th>Week</th>
        <th>Monday</th>
        <th>Tuesday</th>
        <th>Wednesday</th>
        <th>Thursday</th>
        <th>Friday</th>
        <th>Actions</th>
        <th>Enfants</th>
    </tr>
    </thead>
    <tbody>
    <?php
foreach ($weeks as $week)
{
    $foundMatch = false;
    foreach ($childrenEnrollments as $childEnrollment)
    {
        //var_dump($childEnrollment);
        //echo '<br>';
        $firstName = $childEnrollment[0];
        //var_dump($firstName);
        //echo '<br>';
        $enrollments = $childEnrollment[1];
        //var_dump($enrollments);
        //echo '<br>';

        foreach ($enrollments as $item)
        {
            if (!$foundMatch && $week->getWeekOfYear() === $item->getWeekOfYear())
            {
                //$foundMatch = true;
                //echo $week->getWeekOfYear().' '.$item->getWeekOfYear().'<br>';
                //echo $firstName.' registered for '.$week->getWeekOfYear();

                $data = $item;
                ?>
                <tr>

                    <td> <?= $data->getWeekOfYear(); ?></td>
                    <!--have another td that takes all td with days inside of it inside a table and tr element-->
                    <td> <?= checkStatus($data->getMonday(), '', 'monday'); ?> </td>
                    <td> <?= checkStatus($data->getTuesday(), '', 'tuesday'); ?> </td>
                    <td> <?= checkStatus($data->getWednesday(), '', 'wednesday'); ?> </td>
                    <td> <?= checkStatus($data->getThursday(), '', 'thursday'); ?> </td>
                    <td> <?= checkStatus($data->getFriday(),'', 'friday'); ?> </td>
                    <td><a href=" /espace-famille/<?= $_SESSION['user_lastName'] ?>/cantine/inscrire/<?= $data->getWeekOfYear(); ?>">Inscrire</a></td>
                    <td> <?= $firstName ?> </td>
                </tr>
                <?php
            }
            else {
                //echo $week->getWeekOfYear().' '.$item->getWeekOfYear().'<br>';
                //echo $firstName.' not registered for '.$week->getWeekOfYear();
                $data = $week;
                ?>
                <tr>
                    <td> Base <?= $data->getWeekOfYear(); ?></td>
                    <td> <?= checkStatus($data->getMonday(), '', 'monday'); ?> </td>
                    <td> <?= checkStatus($data->getTuesday(), '', 'tuesday'); ?> </td>
                    <td> <?= checkStatus($data->getWednesday(), '', 'wednesday'); ?> </td>
                    <td> <?= checkStatus($data->getThursday(), '', 'thursday'); ?> </td>
                    <td> <?= checkStatus($data->getFriday(),'', 'friday'); ?> </td>
                    <td><a href=" /espace-famille/<?= $_SESSION['user_lastName'] ?>/cantine/modifier/<?= $data->getWeekOfYear(); ?>">Modifier</a></td>
                    <td> <?= $firstName ?> </td>
                </tr>
                <?php
                }
            }
        }
    }
    ?>

    </tbody>
</table>

<?php
    foreach ($this->data['childrenEnrollments'] as $childEnrollments)
    {
        $firstName = $childEnrollments[0];
        foreach ($childEnrollments[1] as $enrollment)
        {
            //echo $firstName;
            //echo $enrollment->getWeekOfYear();
        }
    }
?>

<table>
    <thead>
    <tr>
        <th>Week</th>
        <th>Monday</th>
        <th>Tuesday</th>
        <th>Wednesday</th>
        <th>Thursday</th>
        <th>Friday</th>
        <th>Actions</th>
        <th>Enfants</th>
    </tr>
    </thead>
    <tbody>
    <?php
    foreach ($weeks as $week)
    {


        ?>
        <tr>
            <td> <?= $week->getWeekOfYear(); ?></td>
            <!--have another td that takes all td with days inside of it inside a table and tr element-->
            <td> <?= checkStatus($data->getMonday(), '', 'monday'); ?> </td>
            <td> <?= checkStatus($data->getTuesday(), '', 'tuesday'); ?> </td>
            <td> <?= checkStatus($data->getWednesday(), '', 'wednesday'); ?> </td>
            <td> <?= checkStatus($data->getThursday(), '', 'thursday'); ?> </td>
            <td>
                <ul>
                    <?php
                    foreach ($this->data['childrenEnrollments'] as $childEnrollments)
                    {
                        ?>
                        <li>
                            <?php
                            $firstName = $childEnrollments[0];
                            //echo $firstName;
                            $foundMatch = false;
                            foreach ($childEnrollments[1] as $enrollment)
                            {
                                //echo $enrollment->getWeekOfYear();
                                //echo $week->getWeekOfYear();

                                if (!$foundMatch && $enrollment->getWeekOfYear() === $week->getWeekOfYear())
                                {
                                    $foundMatch = true;
                                    //echo 'not empty';
                                    echo checkStatus($enrollment->getFriday(), '', 'friday');
                                    break;
                                }
                                else
                                {
                                    //echo 'empty';
                                    echo checkStatus($week->getFriday(), '', 'friday');
                                }
                            }
                            ?>
                        </li>
                        <?php
                    }
                    ?>
                </ul>
            </td>
            <td><a href="/espace-famille/<?= $_SESSION['user_lastName'] ?>/cantine/modifier/<?= $week->getWeekOfYear(); ?>">Modifier</a></td>
            <td>
                <ul>
                    <?php
                    foreach ($this->data['childrenEnrollments'] as $childEnrollments)
                    {
                        ?>
                        <li>
                        <?php
                        $firstName = $childEnrollments[0];
                        echo $firstName;
                            $foundMatch = false;
                        foreach ($childEnrollments[1] as $enrollment)
                        {
                            //echo $enrollment->getWeekOfYear();
                            //echo $week->getWeekOfYear();
                            if (!$foundMatch && $week->getWeekOfYear() === $enrollment->getWeekOfyear())
                            {
                                $foundMatch = true;
                                echo ' Inscrit';
                                break;
                            }
                            else
                            {
                                echo ' Pas inscrit';
                            }
                        }
                        ?>
                        </li>
                    <?php
                    }
                    ?>
                </ul>
            </td>
        </tr>
        </tr>
        <?php
    }
    ?>
    </tbody>
</table>